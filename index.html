<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>New tab</title>
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        background-color: black;
      }

      body {
        background-color: transparent;
        background-size: cover;
        background-position: center center;
        background-repeat: no-repeat;
      }

      .visible {
        visibility: visible;
        opacity: 1;
        transition: opacity .5s linear;
      }

      .hidden {
        visibility: hidden;
        opacity: 0;
        transition: visibility 0s .5s, opacity .5s linear;
      }

      .clock {
        position: absolute;
        color: white;
        font-size: 1em;
        font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, sans-serif;
        padding: 1em;
        line-height: 1em;
        letter-spacing: 0.05em;
        cursor: default;
        text-shadow: 0 0 5px black;
      }
    </style>
  </head>
  <body class="hidden">
    <script>
      /* jshint asi: true, laxcomma: true */

      /**
       * RUN THE SHIT
       *
       * `onload` is used so backgrounds huge list can be listed below, not above.
       * This make code easier to read.
       */
      window.onload = function() {
        loadBackground(backgrounds[getRandomInt(1, backgrounds.length)], function(item, img) {
          console.log(item, img)
          document.body.style.backgroundImage = "url(" + img.src +")"
          document.body.className = "visible"

          startClock()

          // now page is ok, we take some times to load other ref
          preloadAllBackgrounds()
        })

        // we can't do that, history API is limited to current domain
        // well we don't have a domain for file:/// so we are screwed...
        // any idea ?
        // https://github.com/putaindecode/pretty-new-tab/issues/2
        // history.pushState({}, "", "");
      }

      /**
       * load a background
       *
       * @param {Object}   item     background object to load
       * @param {Function} callback callback to execute when image is loaded. First arg is the item itself, 2nd is the image object.
       */
      function loadBackground(item, callback) {
        var img = new Image()
        img.src = item.url
        if (callback) {
          img.onload = callback.bind(callback, item, img)
        }
      }

      /**
       * preload all backgrounds
       */
      function preloadAllBackgrounds() {
        backgrounds.forEach(function(item) {
          loadBackground(item, function(item) { console.log("item preloaded", item)})
        })
      }

      /**
       * Returns a random integer between min (included) and max (excluded)
       *
       * Using Math.round() will give you a non-uniform distribution
       * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random
       */
      function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min)) + min;
      }

      /**
       * What time is it?
       */
      function startClock() {
        var clock = document.createElement('div');
        clock.setAttribute('class', 'clock')

        var updateClock = function () {
          var date = new Date()
          var hours = date.getHours().toString()
          var minutes = date.getMinutes().toString()
          clock.innerHTML = (hours.length < 2 ? '0' : '') + hours + ':' + (minutes.length < 2 ? '0' : '') + minutes
        }

        window.setInterval(updateClock, 60000)
        updateClock()

        document.body.appendChild(clock)
      }

      /**
       * backgrounds data
       * @type {Array}
       */
      var backgrounds = [
      {
          "color": "rgb(120, 126, 181)",
          "url": "backgrounds/01.jpg",
          "source": "Dave Morrow",
          "sourceUrl": "https://www.flickr.com/photos/daves-f-stop/8079071366",
          "title": "La Push, Washington, USA"
      },
      {
          "color": "rgb(212, 162, 87)",
          "url": "backgrounds/02.jpg",
          "source": "Magdalena Roeseler",
          "sourceUrl": "https://www.flickr.com/photos/magdalenaroeseler/10497301253",
          "title": "Zug, Switzerland"
      },
      {
          "color": "rgb(77, 120, 99)",
          "url": "backgrounds/03.jpg",
          "source": "Stian Klo",
          "sourceUrl": "http://500px.com/photo/41198398/h%C3%B8yvika-beach-by-stian-klo",
          "title": "And\u00f8ya, Norway"
      },
      {
          "color": "rgb(237, 150, 131)",
          "url": "backgrounds/04.jpg",
          "source": "skoeber",
          "sourceUrl": "https://www.flickr.com/photos/asphericlens/6345711358",
          "title": "Saxon Switzerland, Germany"
      },
      {
          "color": "rgb(180, 108, 72)",
          "url": "backgrounds/05.jpg",
          "source": "skoeber",
          "sourceUrl": "https://www.flickr.com/photos/asphericlens/14366773224",
          "title": "Saxon Switzerland, Germany"
      },
      {
          "color": "rgb(232, 185, 49)",
          "url": "backgrounds/06.jpg",
          "source": "skoeber",
          "sourceUrl": "https://www.flickr.com/photos/asphericlens/7160610404",
          "title": "Saxony, Germany"
      },
      {
          "color": "rgb(190, 130, 61)",
          "url": "backgrounds/07.jpg",
          "source": "Submit Source",
          "sourceUrl": "mailto:feedback@blah.com",
          "title": "Source Unknown"
      },
      {
          "color": "rgb(180, 84, 44)",
          "url": "backgrounds/08.jpg",
          "source": "Jes\u00fas Ignacio Bravo Soler",
          "sourceUrl": "http://500px.com/photo/68800189/singular-by-jes%C3%BAs-ignacio-bravo-soler",
          "title": "Otzarreta Forest, Spain"
      },
      {
          "color": "rgb(191, 96, 109)",
          "url": "backgrounds/09.jpg",
          "source": "Dave Morrow",
          "sourceUrl": "https://www.flickr.com/photos/daves-f-stop/9593394811",
          "title": "Palouse Falls, Washington, USA"
      },
      {
          "color": "rgb(154, 150, 199)",
          "url": "backgrounds/10.jpg",
          "source": "Dave Morrow",
          "sourceUrl": "https://www.flickr.com/photos/daves-f-stop/11713436133",
          "title": "San Francisco, California, USA"
      },
      {
          "color": "rgb(168, 212, 39)",
          "url": "backgrounds/11.jpg",
          "source": "Dave Morrow",
          "sourceUrl": "https://www.flickr.com/photos/daves-f-stop/8272381830",
          "title": "Auster-Skaftafellssysla, Iceland"
      },
      {
          "color": "rgb(60, 164, 180)",
          "url": "backgrounds/12.jpg",
          "source": "Chris Zielecki",
          "sourceUrl": "https://www.flickr.com/photos/zanthia/7870409330",
          "title": "Hvide Sande, Denmark"
      },
      {
          "color": "rgb(181, 86, 58)",
          "url": "backgrounds/13.jpg",
          "source": "skoeber",
          "sourceUrl": "https://www.flickr.com/photos/asphericlens/7227178308",
          "title": "Paptsdorf, Germany"
      },
      {
          "color": "rgb(61, 108, 180)",
          "url": "backgrounds/14.jpg",
          "source": "Trey Ratcliff",
          "sourceUrl": "https://www.flickr.com/photos/stuckincustoms/3124621920",
          "title": "Teton Range, Wyoming, USA"
      },
      {
          "url": "backgrounds/15.jpg",
          "source": "Trey Ratcliff",
          "sourceUrl": "https://www.flickr.com/photos/stuckincustoms/8704121860/",
          "title": "Tokyo, Japan"
      },
      {
          "url": "backgrounds/16.jpg",
          "source": "Trey Ratcliff",
          "sourceUrl": "https://www.flickr.com/photos/stuckincustoms/11114091294/",
          "title": "Li Jiang, China"
      },
      {
          "url": "backgrounds/17.jpg",
          "source": "Trey Ratcliff",
          "sourceUrl": "https://www.flickr.com/photos/stuckincustoms/11783297005/",
          "title": "Hobbiton, New Zealand"
      },
      {
          "url": "backgrounds/18.jpg",
          "source": "Trey Ratcliff",
          "sourceUrl": "https://www.flickr.com/photos/stuckincustoms/8686957036/",
          "title": "Sydney, Australia"
      },
      {
          "url": "backgrounds/19.jpg",
          "source": "Cristian Ruberti",
          "sourceUrl": "https://www.flickr.com/photos/ambsab/11197203555/in/pool-2179950@N25/",
          "title": "Monte Sagro, Italy"
      },
      {
          "url": "backgrounds/20.jpg",
          "source": "invno1",
          "sourceUrl": "http://www.reddit.com/r/EarthPorn/comments/2fbuw4/mt_jefferson_taken_from_the_pacific_crest_trail_3/",
          "title": "Mt. Jefferson, Oregon, USA"
      },
      {
          "url": "backgrounds/21.jpg",
          "source": "Trey Ratcliff",
          "sourceUrl": "https://www.flickr.com/photos/stuckincustoms/8498614095",
          "title": "Glenorchy, New Zealand"
      },
      {
          "url": "backgrounds/22.jpg",
          "source": "Trey Ratcliff",
          "sourceUrl": "https://www.flickr.com/photos/stuckincustoms/6961023258",
          "title": "Oahu, Hawaii"
      },
      {
          "url": "backgrounds/23.jpg",
          "source": "Trey Ratcliff",
          "sourceUrl": "https://www.flickr.com/photos/stuckincustoms/12933604573/",
          "title": "Virgin Gorda, Virgin Islands"
      },
      {
          "url": "backgrounds/24.jpg",
          "source": "Romain Guy",
          "sourceUrl": "https://www.flickr.com/photos/romainguy/3409068082/",
          "title": "San Francisco, California, USA"
      },
      {
          "url": "backgrounds/25.jpg",
          "source": "Romain Guy",
          "sourceUrl": "https://www.flickr.com/photos/romainguy/8338439169/",
          "title": "Antelope Canyon, Arizona, USA"
      },
      {
          "url": "backgrounds/26.jpg",
          "source": "Romain Guy",
          "sourceUrl": "https://www.flickr.com/photos/romainguy/6840341477/",
          "title": "Kalalu, Hawaii, USA"
      },
      {
          "url": "backgrounds/27.jpg",
          "source": "David Cantu",
          "sourceUrl": "http://500px.com/photo/37449470/-the-view-from-jalama-bluffs-by-david-cantu",
          "title": "Point Arbuello, California, USA"
      },
      {
          "url": "backgrounds/28.jpg",
          "source": "Steve Dunleavy",
          "sourceUrl": "https://www.flickr.com/photos/stevedunleavy/5192342061/",
          "title": "Grand Canyon, Arizona, USA"
      },
      {
          "url": "backgrounds/29.jpg",
          "source": "Conor MacNeill",
          "sourceUrl": "http://500px.com/photo/18655061/yangshuo-cyclist-by-conor-macneill",
          "title": "Guilin, China"
      },
      {
          "url": "backgrounds/30.jpg",
          "source": "Steve Dunleavy",
          "sourceUrl": "https://www.flickr.com/photos/stevedunleavy/5044329063/",
          "title": "Yosemite, California, USA"
      },
      {
          "url": "backgrounds/31.jpg",
          "source": "Jyrki Salmi",
          "sourceUrl": "http://www.flickr.com/photos/salman2000/9321259912",
          "title": "Stunted Pine"
      },
      {
          "url": "backgrounds/32.jpg",
          "source": "Trey Ratcliff",
          "sourceUrl": "https://www.flickr.com/photos/stuckincustoms/8468378029",
          "title": "Great Wall of China"
      },
      {
          "url": "backgrounds/33.jpg",
          "source": "Trey Ratcliff",
          "sourceUrl": "https://www.flickr.com/photos/stuckincustoms/12375331335",
          "title": "Crater Lake, Oregon, USA"
      },
      {
          "url": "backgrounds/34.jpg",
          "source": "Adrian Simionov",
          "sourceUrl": "http://500px.com/photo/63850509/the-place-of-no-words-by-adrian-simionov",
          "title": "Queenstown, New Zealand"
      },
      {
          "url": "backgrounds/35.jpg",
          "impressionUrl": "http://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=tf&c=19&mc=imp&pli=10918568&PluID=0&ord=[timestamp]&rtu=-1",
          "shutterstockPromo": true,
          "source": "Photo by <img src='img/shutterstock.png'>",
          "sourceUrl": "http://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=tf&c=20&mc=click&pli=10918568&PluID=0&ord=[timestamp]",
          "title": "Forest Road"
      },
      {
          "url": "backgrounds/36.jpg",
          "impressionUrl": "http://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=tf&c=19&mc=imp&pli=10918570&PluID=0&ord=[timestamp]&rtu=-1",
          "shutterstockPromo": true,
          "source": "Photo by <img src='img/shutterstock.png'>",
          "sourceUrl": "http://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=tf&c=20&mc=click&pli=10918570&PluID=0&ord=[timestamp]",
          "title": "Boating"
      },
      {
          "url": "backgrounds/37.jpg",
          "impressionUrl": "http://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=tf&c=19&mc=imp&pli=10918571&PluID=0&ord=[timestamp]&rtu=-1",
          "shutterstockPromo": true,
          "source": "Photo by <img src='img/shutterstock.png'>",
          "sourceUrl": "http://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=tf&c=20&mc=click&pli=10918571&PluID=0&ord=[timestamp]",
          "title": "On the Beach"
      },
      {
          "url": "backgrounds/38.jpg",
          "impressionUrl": "http://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=tf&c=19&mc=imp&pli=10918572&PluID=0&ord=[timestamp]&rtu=-1",
          "shutterstockPromo": true,
          "source": "Photo by <img src='img/shutterstock.png'>",
          "sourceUrl": "http://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=tf&c=20&mc=click&pli=10918572&PluID=0&ord=[timestamp]",
          "title": "National Bison Range, Montana, USA"
      }]
    </script>
  </body>
</html>
